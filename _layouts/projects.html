---
layout: default
---

<section class="projects-page">
  <article class="projects-intro">
    <h1>{{ page.title }}</h1>
    {% if page.intro %}
      <p class="projects-intro__deck">{{ page.intro }}</p>
    {% endif %}
    {{ content }}
  </article>

  {% assign tag_collection = "" | split: "" %}
  {% for project in site.projects %}
    {% if project.tags %}
      {% for tag in project.tags %}
        {% unless tag_collection contains tag %}
          {% assign tag_collection = tag_collection | push: tag %}
        {% endunless %}
      {% endfor %}
    {% endif %}
  {% endfor %}
  {% assign tag_collection = tag_collection | sort %}

  {% if tag_collection.size > 0 %}
  <section class="projects-topics projects-topics-ghost" aria-label="Filter projects by type">
    <div class="ghost-filter-block" data-filter-root>
      <div class="panel-header-soft">
        <button class="toggle-pill-soft" type="button" data-filter-toggle aria-expanded="false">
          <span class="toggle-label" data-label-default="Type">Type</span>
          <span class="toggle-count" data-filter-count style="display:none;"></span>
          <span class="toggle-arrow">â–¼</span>
        </button>
      </div>

      <div class="panel-soft" data-filter-panel>
        <div class="panel-inner-soft" data-filter-panel-inner>
          <div class="topics-row-soft">
            {% for tag in tag_collection %}
              {% assign tag_slug = tag | slugify %}
              <button class="chip-soft" type="button" data-topic="{{ tag_slug }}" data-filter-chip aria-pressed="false">{{ tag }}</button>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- meta kept for potential future use; left visually empty for now -->
      <div class="projects-meta" data-filter-meta></div>
    </div>
  </section>
  {% else %}
  <div class="projects-meta"></div>
  {% endif %}

  <div class="projects-list" data-filter-list>
    {% assign sorted_projects = site.projects | sort: 'year' | reverse %}
    {% assign sorted_projects = sorted_projects | sort: 'order' %}
    {% for project in sorted_projects %}
      {% assign tag_slugs_array = "" | split: "" %}
      {% if project.tags %}
        {% for tag in project.tags %}
          {% assign tag_slug = tag | slugify %}
          {% assign tag_slugs_array = tag_slugs_array | push: tag_slug %}
        {% endfor %}
      {% endif %}
      {% assign tag_slugs_attr = tag_slugs_array | join: ' ' %}
      <div class="project-entry" {% if tag_slugs_attr != '' %}data-tag-slugs="{{ tag_slugs_attr }}"{% endif %}>
        <div class="project-year">{{ project.year }}</div>
        <div class="project-content">
          <h3 class="project-title">
            <a href="{{ project.url | relative_url }}">{{ project.title }}</a>
          </h3>
          <p class="project-description">{{ project.description }}</p>
        </div>
      </div>
    {% endfor %}
  </div>
</section>

<script>
  (function () {
    var root = document.querySelector('[data-filter-root]');
    if (!root) return;

    var toggle = root.querySelector('[data-filter-toggle]');
    var panel = root.querySelector('[data-filter-panel]');
    var panelInner = root.querySelector('[data-filter-panel-inner]');
    var chips = Array.prototype.slice.call(root.querySelectorAll('[data-filter-chip]'));
    var countEl = root.querySelector('[data-filter-count]');
    var labelEl = toggle ? toggle.querySelector('[data-label-default]') : null;
    var meta = root.querySelector('[data-filter-meta]');
    var entries = Array.prototype.slice.call(document.querySelectorAll('[data-filter-list] .project-entry'));
    var defaultLabel = labelEl ? (labelEl.getAttribute('data-label-default') || labelEl.textContent) : '';

    if (!toggle || !panel || !panelInner) return;

    toggle.addEventListener('click', function (e) {
      e.preventDefault();
      var isExpanded = panel.classList.contains('is-expanded');
      panel.classList.toggle('is-expanded');
      toggle.classList.toggle('is-expanded');
      toggle.setAttribute('aria-expanded', (!isExpanded).toString());
    });

    chips.forEach(function (chip) {
      chip.addEventListener('mousedown', function (e) { e.preventDefault(); });
      chip.addEventListener('click', function (e) {
        e.preventDefault();
        e.stopPropagation();

        var isActive = chip.classList.contains('is-active');

        // If this chip is already active, clear all (back to "all types")
        if (isActive) {
          chips.forEach(function (btn) {
            btn.classList.remove('is-active');
            btn.setAttribute('aria-pressed', 'false');
          });
          chip.blur();
          update();
          return;
        }

        // Otherwise, deactivate all and activate only this one (single-select)
        chips.forEach(function (btn) {
          btn.classList.remove('is-active');
          btn.setAttribute('aria-pressed', 'false');
        });
        chip.classList.add('is-active');
        chip.setAttribute('aria-pressed', 'true');
        chip.blur();
        update();
      });
    });

    function update() {
      var activeTypes = chips
        .filter(function (chip) { return chip.classList.contains('is-active'); })
        .map(function (chip) { return chip.getAttribute('data-topic'); });

      var noneSelected = activeTypes.length === 0;
      var count = activeTypes.length;

      if (countEl && labelEl) {
        // Always hide count + keep static label; no "1 type selected" state
        countEl.style.display = 'none';
        countEl.textContent = '';
        labelEl.textContent = defaultLabel;
        toggle.classList.remove('has-filters');
      }

      var visibleCount = 0;
      entries.forEach(function (entry) {
        var entryTypes = (entry.dataset.tagSlugs || '').split(' ').filter(Boolean);

        // When no filters are selected, show everything
        if (noneSelected) {
          entry.classList.remove('is-hidden');
          visibleCount++;
          return;
        }

        // When filters are active, only show entries that match at least one selected type
        var hasMatch = entryTypes.some(function (type) {
          return activeTypes.indexOf(type) !== -1;
        });

        entry.classList.toggle('is-hidden', !hasMatch);
        if (hasMatch) visibleCount++;
      });

      if (meta) {
        meta.textContent = '';
      }
    }

    update();
  })();
</script>
