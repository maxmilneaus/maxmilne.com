---
layout: default
---

<section class="writing2-page">
  <article class="writing2-intro">
    <h1>{{ page.title }}</h1>
    {{ content }}
  </article>

  {% assign tag_collection = "" | split: "" %}
  {% for note in site.notes %}
    {% if note.tags %}
      {% for tag in note.tags %}
        {% unless tag_collection contains tag %}
          {% assign tag_collection = tag_collection | push: tag %}
        {% endunless %}
      {% endfor %}
    {% endif %}
  {% endfor %}
  {% assign tag_collection = tag_collection | sort %}
  {% assign sorted_notes = site.notes | sort: "created_at_timestamp" | reverse %}
  {% assign total_entries = sorted_notes | size %}

  {% if tag_collection.size > 0 %}
  <section class="writing2-topics writing2-topics-ghost" aria-label="Filter essays by topic">
    <div class="ghost-filter-block" data-filter-root>
      <!-- Visual key -->
      <div class="writing2-key">
        <span class="key-label">
          <span class="key-icon key-icon-photo">◐</span>
          <span>Photo Essay</span>
        </span>
        <span class="key-spacer"></span>
        <button class="toggle-pill-soft" type="button" data-filter-toggle aria-expanded="false">
          <span class="toggle-label" data-label-default="Topics">Filter by topics</span>
          <span class="toggle-count" data-filter-count style="display:none;"></span>
          <span class="toggle-arrow">▼</span>
        </button>
      </div>

      <div class="panel-soft" data-filter-panel>
        <div class="panel-inner-soft" data-filter-panel-inner>
          <div class="topics-row-soft">
            {% for tag in tag_collection %}
              {% assign tag_slug = tag | slugify %}
              <button class="chip-soft" type="button" data-topic="{{ tag_slug }}" data-filter-chip aria-pressed="false">{{ tag }}</button>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- meta kept for potential future use; left visually empty for now -->
      <div class="writing-meta" data-filter-meta></div>
    </div>
  </section>
  {% else %}
  <div class="writing-meta">
    <span class="key-label">
      <span class="key-icon key-icon-photo">◐</span>
      <span>Photo Essay</span>
    </span>
  </div>
  {% endif %}

  <div class="writing2-list" data-filter-list>
    <ul>
    {% for note in sorted_notes %}
      {% assign tag_slugs_array = "" | split: "" %}
      {% if note.tags %}
        {% for tag in note.tags %}
          {% assign tag_slug = tag | slugify %}
          {% assign tag_slugs_array = tag_slugs_array | push: tag_slug %}
        {% endfor %}
      {% endif %}
      {% assign tag_slugs_attr = tag_slugs_array | join: ' ' %}
      {% assign display_date = note.created_at | default: note.date | default: note.last_modified_at %}
      {% assign is_photo_essay = false %}
      {% if note.tags %}
        {% for t in note.tags %}
          {% assign t_lc = t | downcase %}
          {% if t_lc contains 'photo' or t_lc contains 'photos' or t_lc contains 'photography' %}
            {% assign is_photo_essay = true %}
          {% endif %}
        {% endfor %}
      {% endif %}
      {% if is_photo_essay %}
        {% assign indicator = '◐' %}
      {% else %}
        {% assign indicator = '' %}
      {% endif %}
      <li class="writing2-entry" {% if tag_slugs_attr != '' %}data-tag-slugs="{{ tag_slugs_attr }}"{% endif %}>
        <a class="internal-link" href="{{ note.url | relative_url }}">
          <span class="article-date">{{ display_date | date: "%Y · %m" }}</span>
          <span class="article-title">
            {{ note.title }}
            {% if indicator != '' %}
              <span class="article-indicator article-indicator-photo">{{ indicator }}</span>
            {% endif %}
          </span>
        </a>
      </li>
    {% endfor %}
    </ul>
  </div>
</section>

<script>
  (function () {
    var root = document.querySelector('[data-filter-root]');
    if (!root) return;

    var toggle = root.querySelector('[data-filter-toggle]');
    var panel = root.querySelector('[data-filter-panel]');
    var panelInner = root.querySelector('[data-filter-panel-inner]');
    var chips = Array.prototype.slice.call(root.querySelectorAll('[data-filter-chip]'));
    var clearBtn = root.querySelector('[data-filter-clear]');
    var clearContainer = root.querySelector('[data-filter-clear-container]');
    var countEl = root.querySelector('[data-filter-count]');
    var labelEl = toggle ? toggle.querySelector('[data-label-default]') : null;
    var meta = root.querySelector('[data-filter-meta]');
    var entries = Array.prototype.slice.call(document.querySelectorAll('[data-filter-list] .writing2-entry'));
    var defaultLabel = labelEl ? (labelEl.getAttribute('data-label-default') || labelEl.textContent) : '';

    if (!toggle || !panel || !panelInner) return;

    toggle.addEventListener('click', function (e) {
      e.preventDefault();
      var isExpanded = panel.classList.contains('is-expanded');
      panel.classList.toggle('is-expanded');
      toggle.classList.toggle('is-expanded');
      toggle.setAttribute('aria-expanded', (!isExpanded).toString());
      if (clearContainer) {
        clearContainer.style.display = isExpanded ? 'none' : 'flex';
      }
    });

    chips.forEach(function (chip) {
      chip.addEventListener('mousedown', function (e) { e.preventDefault(); });
      chip.addEventListener('click', function (e) {
        e.preventDefault();
        e.stopPropagation();

        var isActive = chip.classList.contains('is-active');

        // If this chip is already active, clear all (back to "all topics")
        if (isActive) {
          chips.forEach(function (btn) {
            btn.classList.remove('is-active');
            btn.setAttribute('aria-pressed', 'false');
          });
          chip.blur();
          update();
          return;
        }

        // Otherwise, deactivate all and activate only this one (single-select)
        chips.forEach(function (btn) {
          btn.classList.remove('is-active');
          btn.setAttribute('aria-pressed', 'false');
        });
        chip.classList.add('is-active');
        chip.setAttribute('aria-pressed', 'true');
        chip.blur();
        update();
      });
    });

    if (clearBtn) {
      clearBtn.addEventListener('click', function (e) {
        e.preventDefault();
        chips.forEach(function (chip) {
          chip.classList.remove('is-active');
          chip.setAttribute('aria-pressed', 'false');
        });
        clearBtn.blur();
        update();
      });
    }

    function update() {
      var activeTopics = chips
        .filter(function (chip) { return chip.classList.contains('is-active'); })
        .map(function (chip) { return chip.getAttribute('data-topic'); });

      var noneSelected = activeTopics.length === 0;
      var count = activeTopics.length;

      if (countEl && labelEl) {
        // Always hide count + keep static label; no "1 topic selected" state
        countEl.style.display = 'none';
        countEl.textContent = '';
        labelEl.textContent = defaultLabel;
        toggle.classList.remove('has-filters');
      }

      var visibleCount = 0;
      entries.forEach(function (entry) {
        var entryTopics = (entry.dataset.tagSlugs || '').split(' ').filter(Boolean);
        var hasMatch = noneSelected || entryTopics.some(function (topic) {
          return activeTopics.indexOf(topic) !== -1;
        });
        entry.classList.toggle('is-hidden', !hasMatch);
        if (hasMatch) visibleCount++;
      });

      if (meta) {
        // No "Showing N entries" text — keep interface minimal
        meta.textContent = '';
      }
    }

    update();
  })();
</script>
